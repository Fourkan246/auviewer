{% extends 'base.html' %}

{% block css %}
<link rel='stylesheet' href='{{ rootWebPath }}/css/third-party/dygraph.css'/>
<link rel='stylesheet' href='{{ rootWebPath }}/css/app.css'/>
{% endblock %}

{% block js %}
<!-- SockerIO for pseudo-realtime connectivity -->
<script src="{{ rootWebPath }}/js/third-party/socket.io.js" integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I="></script>

<!-- Dygraphs & Synchronizer -->
<script src="{{ rootWebPath }}/js/third-party/dygraph.js"></script>
<script src="{{ rootWebPath }}/js/third-party/synchronizer.js"></script>

<!-- Random color generator -->
<script src="{{ rootWebPath }}/js/third-party/random_color.js"></script>

<!-- Config -->
<script src="{{ rootWebPath }}/js/config.js"></script>

<!-- Classes -->
<script src="{{ rootWebPath }}/js/classes/annotation.js"></script>
<script src="{{ rootWebPath }}/js/classes/file.js"></script>
<script src="{{ rootWebPath }}/js/classes/globalstatemanager.js"></script>
<script src="{{ rootWebPath }}/js/classes/graph.js"></script>
<script src="{{ rootWebPath }}/js/classes/graphselectionmenu.js"></script>
<script src="{{ rootWebPath }}/js/classes/project.js"></script>
<script src="{{ rootWebPath }}/js/classes/requesthandler.js"></script>
<script src="{{ rootWebPath }}/js/classes/templatesystem.js"></script>

<!-- Function Libraries -->
<script src="{{ rootWebPath }}/js/event_handlers.js"></script>
<script src="{{ rootWebPath }}/js/helpers.js"></script>

<!-- App Main -->
<script src="{{ rootWebPath }}/js/app.js"></script>
{% endblock %}

{% block content %}
<div id="controls">

	<div id="projectAndFileSelection">

		<h5>Project</h5>

		<div class="form-group">
			<select class="form-control form-control-sm" id="project_selection" onchange="globalStateManager.newMainProject();">
				<option></option>
			</select>
		</div>

		<h5>File</h5>

		<div class="form-group">
			<select class="form-control form-control-sm" id="file_selection" onchange="globalStateManager.newMainFile();">
			</select>
		</div>

	</div>

	<h5>Zoom Control</h5>
	<div style="width: 100%; margin-bottom: 10px;">
		<div style="width: 100%; text-align: center; margin-bottom: 4px;">
			<button onclick="globalStateManager.currentFile && globalStateManager.currentFile.zoomTo(21600000);">6hr</button>
			<button onclick="globalStateManager.currentFile && globalStateManager.currentFile.zoomTo(7200000);">2hr</button>
			<button onclick="globalStateManager.currentFile && globalStateManager.currentFile.zoomTo(3600000);">1hr</button>
			<button onclick="globalStateManager.currentFile && globalStateManager.currentFile.zoomTo(600000);">10m</button>
		</div>
		<div style="width: 100%; text-align: center; margin-bottom: 4px;">
			<button onclick="globalStateManager.currentFile && globalStateManager.currentFile.zoomTo(60000);">1m</button>
			<button onclick="globalStateManager.currentFile && globalStateManager.currentFile.zoomTo(10000);">10s</button>
			<button onclick="globalStateManager.currentFile && globalStateManager.currentFile.zoomTo(1000);">1s</button>
		</div>
		<div style="width: 100%; text-align: center;">
			<button onclick="globalStateManager.currentFile && globalStateManager.currentFile.resetZoomToOutermost();">All</button>
			<button onclick="globalStateManager.currentFile && globalStateManager.currentFile.zoomBy(0, .1);">-</button>
			<button onclick="globalStateManager.currentFile && globalStateManager.currentFile.zoomBy(1, .1);">+</button>
		</div>
	</div>

	<h5>Annotation Workflow</h5>
	<span class="clickable" onclick="globalStateManager.currentFile.annotationWorkflowPrevious();">&lt; Prev</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="clickable" onclick="globalStateManager.currentFile.annotationWorkflowNext();">Next &gt;</span>
	<div id="annotationWorkflowSubtext"></div>
	<br><br>

	<h5>Data Series</h5>

	<div id="series_toggle_controls" class="form-group"></div>

	<div id="anomalyDetectionPanel">

		<h5>Anomaly Detection</h5>

		<div class="form-group row" style="margin-bottom: 0.3rem">
			<label for="alert_gen_series_field" class="col-sm-5 col-form-label col-form-label-sm">Series</label>
			<div class="col-sm-7">
				<select class="form-control form-control-sm" id="alert_gen_series_field">
					<option></option>
				</select>
			</div>
		</div>
		<div class="form-group row" style="margin-bottom: 0.3rem">
			<label for="alert_gen_threshold_high_field" class="col-sm-5 col-form-label col-form-label-sm">Threshold<sub>High</sub></label>
			<div class="col-sm-7">
				<input class="form-control form-control-sm" type="text" id="alert_gen_threshold_high_field" placeholder="e.g. 200" />
			</div>
		</div>
		<div class="form-group row" style="margin-bottom: 0.3rem">
			<label for="alert_gen_threshold_low_field" class="col-sm-5 col-form-label col-form-label-sm">Threshold<sub>Low</sub></label>
			<div class="col-sm-7">
				<input class="form-control form-control-sm" type="text" id="alert_gen_threshold_low_field" placeholder="e.g. 70" />
			</div>
		</div>
		<div class="form-group row" style="margin-bottom: 0.3rem">
			<label for="alert_gen_duration_field" class="col-sm-5 col-form-label col-form-label-sm">Duration (s)</label>
			<div class="col-sm-7">
				<input class="form-control form-control-sm" type="text" id="alert_gen_duration_field" placeholder="e.g. 60" />
			</div>
		</div>
		<div class="form-group row" style="margin-bottom: 0.3rem">
			<label for="alert_gen_dutycycle_field" class="col-sm-5 col-form-label col-form-label-sm" style="white-space: nowrap;">Persistence (%)</label>
			<div class="col-sm-7">
				<input class="form-control form-control-sm" type="text" id="alert_gen_dutycycle_field" placeholder="e.g. 70" />
			</div>
		</div>
		<div class="form-group row" style="margin-bottom: 0.3rem">
			<label for="alert_gen_maxgap_field" class="col-sm-5 col-form-label col-form-label-sm">Max Gap (s)</label>
			<div class="col-sm-7">
				<input class="form-control form-control-sm" type="text" id="alert_gen_maxgap_field" placeholder="e.g. 60" />
			</div>
		</div>
		<div class="form-group row">
			<div class="col-sm-12 text-right">
				<button onclick="if (confirm('Are you sure you want to clear anomalies?\n\nNote: This will only clear the anomalies from your current browsing session. Memorized anomaly detection will re-run upon reload.')) { globalStateManager.currentFile.clearAnomalies(); }" class="btn btn-secondary btn-sm">Clear</button>
				<button onclick="globalStateManager.currentFile.detectAnomaliesFromForm();" class="btn btn-primary btn-sm">Generate</button>
			</div>
		</div>

	</div>

<!--			<button onclick="generateAlerts();" style="float: right;">Generate</button>-->
<!--			<button onclick="clearAnomalies();" style="float: right; margin-right: 4px;">Clear</button>-->

	<div id="control_footer">

		<p id="enterrealtime" onclick="globalStateManager.enterRealtimeMode();">Switch to Realtime</p>
		<p id="exitrealtime" onclick="globalStateManager.exitRealtimeMode();">Exit Realtime</p>

	</div>

</div>
<div id="graphs">

<!--	<video controls>-->
<!--		<source src="js/sample.webm" type="video/webm">-->
<!--		Your browser does not support the video tag.-->
<!--	</video>-->

</div>

<!-- Annotation Modal -->
<div class="modal fade" id="annotationModal" tabindex="-1" role="dialog" aria-labelledby="annotationModalTitle" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="annotationModalTitle">Annotation</h5>
				<button type="button" class="close cancelButton" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<form>
<!--					<div class="form-group">-->
<!--						<label for="annotationLabel">Label</label>-->
<!--						<select class="form-control" id="annotationLabel" name="annotationLabel">-->
<!--							<option value="Real">Real</option>-->
<!--							<option value="Artifact">Artifact</option>-->
<!--						</select>-->
<!--					</div>-->
					<div class="form-group">
						<label>Confidence</label><br>
						<div class="form-check form-check-inline">
							<input class="form-check-input" type="radio" name="annotationConfidence" id="inlineRadio-n3" value="-3">
							<label class="form-check-label" for="inlineRadio-n3">-3</label>
						</div>
						<div class="form-check form-check-inline">
							<input class="form-check-input" type="radio" name="annotationConfidence" id="inlineRadio-n2" value="-2">
							<label class="form-check-label" for="inlineRadio-n2">-2</label>
						</div>
						<div class="form-check form-check-inline">
							<input class="form-check-input" type="radio" name="annotationConfidence" id="inlineRadio-n1" value="-1">
							<label class="form-check-label" for="inlineRadio-n1">-1</label>
						</div>
						<div class="form-check form-check-inline">
							<input class="form-check-input" type="radio" name="annotationConfidence" id="inlineRadio-0" value="0">
							<label class="form-check-label" for="inlineRadio-0">0</label>
						</div>
						<div class="form-check form-check-inline">
							<input class="form-check-input" type="radio" name="annotationConfidence" id="inlineRadio-1" value="1">
							<label class="form-check-label" for="inlineRadio-1">+1</label>
						</div>
						<div class="form-check form-check-inline">
							<input class="form-check-input" type="radio" name="annotationConfidence" id="inlineRadio-2" value="2">
							<label class="form-check-label" for="inlineRadio-2">+2</label>
						</div>
						<div class="form-check form-check-inline">
							<input class="form-check-input" type="radio" name="annotationConfidence" id="inlineRadio-3" value="3">
							<label class="form-check-label" for="inlineRadio-3">+3</label>
						</div>
					</div>
					<div class="form-group">
						<label for="annotationNotes">Notes</label>
						<textarea class="form-control" id="annotationNotes" rows="3"></textarea>
					</div>
					<div class="form-row">
						<div class="col">
							<label for="annotationStart">Start Time</label>
							<input type="date" class="form-control" id="annotationStartDate"><input type="time" class="form-control" id="annotationStartTime" step="1">
						</div>
						<div class="col">
							<label for="annotationEnd">End Time</label>
							<input type="date" class="form-control" id="annotationEndDate"><input type="time" class="form-control" id="annotationEndTime" step="1">
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-danger mr-auto deleteButton">Delete</button>
				<button type="button" class="btn btn-secondary cancelButton" data-dismiss="modal">Cancel</button>
				<button type="button" class="btn btn-primary saveButton">Save</button>
			</div>
		</div>
	</div>
</div>

{% endblock %}